<h1><%= @post.title %></h1>
<p><%= @post.body %></p>
<%if @category%>
  <p><%= @category.title %></p>
<%end%>

<section class="star-widget">
  Post Average Rating: <%= average_star(@post) %>
</section>

<% if can? :manage, @post %>
  <%= link_to "Edit", edit_post_path(@post)%>
  <%= link_to "Delete", post_path(@post),
                        method: :delete,
                        data: {confirm: 'Are you sure you want to delete this post?'}%>
<%end%>
<br>
<br>
<% if user_signed_in? && can?(:favourite, @post)%>
  <%favourite = @post.favourites.find_by(user: current_user) %>
  <% if favourite.present? %>
  <br>
    <%= link_to "Unfavourite", post_favourite_path(@post, favourite), method: :delete %>
    <%else%>
      <%= link_to "Favourite", post_favourites_path(@post), method: :post %>
  <%end%>
<%end%>
<%= pluralize(@post.favourites.count, "Favourite") %>
<br>
<br>
<section>
  Tags: <%= @post.tags.map(&:name).join(", ") %>
</section>
<br>
<section class="star-widget">
  Rate this Post:
  <%= display_star(@post) %>
</section>
<br>
<%= @comment.errors.full_messages.join(', ')%>
<%= form_for [@post, @comment] do |f| %>
  <div>
    <%= f.label :body%>
    <%= f.text_area :body%>
  </div>
  <br>
  <div>
  <%= f.submit%>
  </div>
<% end %>
<br>
<%if @post.comments.size != 0 %>
<h2>Comments</h2>
    <% @post.comments.each do |comment| %>
      <%= comment.body %>
      <br>
      <% if user_signed_in? && can?(:delete, comment)%>
        <%= link_to 'delete', post_comment_path(@post, comment), method: :delete, data: { confirm: 'Are you sure?'} %>

        <br>
      <hr>
      <%end%>
    <%end%>
<%end%>
